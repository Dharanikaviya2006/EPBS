<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HE5 Event Branding System</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Lora:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{ --orange:#fc7800; --orange-light:#ff9d3f; }

body{
  margin:0;
  font-family:'Poppins',sans-serif;
  background:linear-gradient(135deg,#fc7800,#ff9d3f);
  overflow-x:hidden;
}

/* Decorative soft shapes */
body::before, body::after{
  content:"";
  position:fixed;
  border-radius:50%;
  z-index:0;
  opacity:.15;
}
body::before{
  width:500px;height:500px;
  background:#fff;
  top:-150px; right:-150px;
}
body::after{
  width:400px;height:400px;
  background:#000;
  bottom:-120px; left:-120px;
}

/* Hero */
.hero{
  text-align:center;
  padding:70px 20px 50px;
  color:white;
  position:relative;
  z-index:1;
}

.section{
  width:100%;
  max-width:1100px;
  margin:40px auto;
  background:#fff;
  padding:30px;
  border-radius:20px;
  box-shadow:0 15px 40px rgba(0,0,0,0.12);
  position:relative;
  z-index:1;
}

/* subtle pattern */
.section::before{
  content:"";
  position:absolute;
  width:140px;height:140px;
  background:radial-gradient(circle,var(--orange-light) 2px,transparent 2px);
  background-size:14px 14px;
  opacity:.12;
  top:10px; right:10px;
}

h2{font-family:'Lora',serif;color:var(--orange)}

input,textarea,select,button{
  width:100%; margin-top:12px; padding:12px;
  border-radius:10px; font-family:inherit; font-size:14px;
}
button{ background:var(--orange); color:#fff; border:none; font-weight:600; cursor:pointer; }

.editor-layout{ display:flex; gap:30px; flex-wrap:wrap; align-items:flex-start; }
.editor-left,.editor-right{
  width:220px; background:#fafafa; padding:18px; border-radius:16px;
  box-shadow:0 10px 25px rgba(0,0,0,0.08);
}
.editor-main{ flex:1 1 400px; }

.frame-container{
  position:relative;
  width:100%;
  aspect-ratio:1/1;
  overflow:hidden;
  border-radius:16px;
  background:#f3f3f3;
  touch-action:none;
  cursor:grab;
}
.frame-container:active{cursor:grabbing}

.photo,.frame{
  position:absolute;
  top:50%;
  left:50%;
  transform-origin:center;
  user-select:none;
  pointer-events:none;
}

.caption{ margin-top:16px; text-align:left; font-size:14px; }
.notice{ text-align:center; font-size:13px; color:var(--orange); margin-top:8px; height:18px; }
.hidden{display:none}
.back-btn{background:#888 !important;margin-bottom:10px;}

@media(max-width:900px){
  .editor-layout{flex-direction:column}
  .editor-left,.editor-right{width:100%}
}
</style>
</head>
<body>

<div class="hero">
  <h1>HE5 Solutions Event Branding</h1>
  <p>Create professional branded event photos instantly</p>
</div>

<!-- STEP 1 -->
<div class="section" id="setupSection">
  <h2>Step 1: Setup Frame</h2>
  <input type="file" id="frameUpload" accept="image/*">
  <textarea id="defaultCaption" placeholder="Default professional caption"></textarea>
  <input type="text" id="defaultTags" placeholder="#HE5Solutions #Innovation">
  <button onclick="saveSetup()">Continue</button>
</div>

<!-- STEP 2 -->
<div class="section hidden" id="editorSection">
  <button class="back-btn" onclick="goBack()">â¬… Back to Setup</button>
  <h2>HE5 Solutions Editor</h2>

  <div class="editor-layout">

    <div class="editor-left">
      <label>Image Fit Mode</label>
      <select id="fitMode"><option value="fit">Fit</option><option value="fill">Fill</option></select>

      <label>Frame Fit Mode</label>
      <select id="frameFitMode"><option value="fit">Fit</option><option value="fill">Fill</option></select>

      <button onclick="centerImage()">Center Image</button>
      <button onclick="resetImage()">Reset Image</button>
    </div>

    <div class="editor-main">
      <div class="frame-container" id="captureArea">
        <img id="userPhoto" class="photo">
        <img id="frameOverlay" class="frame">
      </div>

      <div class="caption">
        <div id="captionText"></div>
        <div id="hashText"></div>
      </div>

      <input type="file" id="photoUpload" accept="image/*">

      <select id="downloadFormat">
        <option value="png">Download PNG</option>
        <option value="jpg">Download JPG</option>
        <option value="jpeg">Download JPEG</option>
        <option value="pdf">Download PDF</option>
      </select>

      <button onclick="downloadImage()">Download</button>
      <button onclick="shareImage()">Share</button>
      <div class="notice" id="notice"></div>
    </div>

    <div class="editor-right">
      <label>Photo Zoom</label>
      <input type="range" id="photoZoom" min="0.2" max="4" step="0.01" value="1">
      <label>Frame Size</label>
      <input type="range" id="frameZoom" min="0.5" max="2" step="0.01" value="1">
    </div>

  </div>
</div>

<script>
document.addEventListener("keydown",e=>{
 if(e.key==="Enter" && !setupSection.classList.contains("hidden")){
   e.preventDefault(); saveSetup();
 }
});

function goBack(){
 editorSection.classList.add("hidden");
 setupSection.classList.remove("hidden");
}

const DEFAULT_TAGS = ["#HE5Solutions","#EventBranding","#Innovation"];

const frameUpload=document.getElementById("frameUpload");
const defaultCaption=document.getElementById("defaultCaption");
const defaultTags=document.getElementById("defaultTags");
const setupSection=document.getElementById("setupSection");
const editorSection=document.getElementById("editorSection");
const frameOverlay=document.getElementById("frameOverlay");
const userPhoto=document.getElementById("userPhoto");
const photoUpload=document.getElementById("photoUpload");
const captionText=document.getElementById("captionText");
const hashText=document.getElementById("hashText");
const fitMode=document.getElementById("fitMode");
const frameFitMode=document.getElementById("frameFitMode");
const captureArea=document.getElementById("captureArea");
const photoZoom=document.getElementById("photoZoom");
const frameZoom=document.getElementById("frameZoom");
const downloadFormat=document.getElementById("downloadFormat");
const notice=document.getElementById("notice");

let caption="", tags=[], photoScale=1, frameScale=1, photoX=0, photoY=0;
let dragging=false,startX=0,startY=0,startDist=0,startScale=1;

/* ---------- HASHTAG RENDERER ---------- */
function renderTags(){
 hashText.innerHTML="";
 tags.forEach(tag=>{
   const a=document.createElement("a");
   a.style.marginRight="8px";
   a.style.textDecoration="none";
   a.style.color="#fc7800";
   a.style.fontWeight="600";
   a.target="_blank";

   if(tag.startsWith("#")){
     const clean=tag.replace("#","");
     a.href=`https://twitter.com/hashtag/${clean}`;
     a.textContent=tag;
   }
   else if(tag.startsWith("http://") || tag.startsWith("https://")){
     a.href=tag;
     a.textContent=tag;
   }
   else{
     a.href="https://google.com/search?q="+encodeURIComponent(tag);
     a.textContent=tag;
   }
   hashText.appendChild(a);
 });
}

/* ---------- SETUP ---------- */
function saveSetup(){
 const file=frameUpload.files[0];
 if(!file) return alert("Upload a frame image");
 const reader=new FileReader();
 reader.onload=e=>{
   frameOverlay.onload=autoFitFrame;
   frameOverlay.src=e.target.result;
   caption=defaultCaption.value;

   const userTags = defaultTags.value.split(" ").filter(t=>t.trim()!=="");
   tags = [...DEFAULT_TAGS, ...userTags];

   captionText.textContent=caption;
   renderTags();

   setupSection.classList.add("hidden");
   editorSection.classList.remove("hidden");
 };
 reader.readAsDataURL(file);
}

/* ---------- IMAGE LOGIC (UNCHANGED) ---------- */
photoUpload.onchange=e=>{
 const reader=new FileReader();
 reader.onload=ev=>{
   userPhoto.onload=autoFitImage;
   userPhoto.src=ev.target.result;
 };
 reader.readAsDataURL(e.target.files[0]);
};

function autoFitImage(){
 const box=captureArea.getBoundingClientRect();
 const scaleX=box.width/userPhoto.naturalWidth;
 const scaleY=box.height/userPhoto.naturalHeight;
 photoScale = fitMode.value==="fit"?Math.min(scaleX,scaleY):Math.max(scaleX,scaleY);
 photoX=0; photoY=0;
 photoZoom.value=photoScale;
 updatePhoto();
}

function autoFitFrame(){
 const box=captureArea.getBoundingClientRect();
 const scaleX=box.width/frameOverlay.naturalWidth;
 const scaleY=box.height/frameOverlay.naturalHeight;
 frameScale = frameFitMode.value==="fit"?Math.min(scaleX,scaleY):Math.max(scaleX,scaleY);
 updateFrame();
}

function updatePhoto(){ userPhoto.style.transform=`translate(-50%,-50%) translate(${photoX}px,${photoY}px) scale(${photoScale})`; }
function updateFrame(){ frameOverlay.style.transform=`translate(-50%,-50%) scale(${frameScale})`; }

captureArea.addEventListener("pointerdown",e=>{ dragging=true; startX=e.clientX-photoX; startY=e.clientY-photoY; captureArea.setPointerCapture(e.pointerId); });
captureArea.addEventListener("pointermove",e=>{ if(!dragging) return; photoX=e.clientX-startX; photoY=e.clientY-startY; updatePhoto(); });
captureArea.addEventListener("pointerup",()=>dragging=false);

photoZoom.oninput=()=>{photoScale=photoZoom.value;updatePhoto();}
frameZoom.oninput=()=>{frameScale=frameZoom.value;updateFrame();}
fitMode.onchange=autoFitImage;
frameFitMode.onchange=autoFitFrame;

function centerImage(){photoX=0;photoY=0;updatePhoto();}
function resetImage(){autoFitImage();}

/* ---------- EXPORT ---------- */
function generateCanvas(){return html2canvas(captureArea);}

async function downloadImage(){
 const canvas=await generateCanvas();
 const format=downloadFormat.value;
 if(format==="pdf"){
   const { jsPDF }=window.jspdf;
   const pdf=new jsPDF();
   pdf.addImage(canvas.toDataURL("image/png"),"PNG",10,10,180,180);
   pdf.save("event-frame.pdf");
 } else {
   const a=document.createElement("a");
   a.download=`event-frame.${format}`;
   a.href=canvas.toDataURL(`image/${format}`);
   a.click();
 }
}

async function shareImage(){
 const canvas=await generateCanvas();
 const text=`${caption} ${tags.join(" ")}`;
 await navigator.clipboard.writeText(text);
 notice.textContent="Caption & hashtags copied!";
 setTimeout(()=>notice.textContent="",2000);

 canvas.toBlob(async blob=>{
   const file=new File([blob],"event-frame.png",{type:"image/png"});
   if(navigator.share && navigator.canShare({files:[file]})){
     await navigator.share({files:[file],text,title:"Event Post"});
   }
 });
}
</script>

</body>
</html>
