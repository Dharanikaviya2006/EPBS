<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HE5 Solutions Frame Creator</title>
<link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
:root{
  --bg:#f5efe6;
  --card:#fffdf9;
  --text:#000;
  --accent:#c8a27a;
  --button:#d6a77a;
}
body.dark{
  --bg:#1f1f1f;
  --card:#2a2a2a;
  --text:#ffffff;
  --accent:#e6b89c;
  --button:#c97c5d;
}
body{
  margin:0;
  font-family:"Times New Roman","Lora","Calibri",serif;
  background:var(--bg);
  color:var(--text);
  padding:20px;
}

/* Toggle top-right */
.theme-toggle{
  position:fixed;
  top:15px;
  right:20px;
  display:flex;
  align-items:center;
  gap:8px;
  font-size:14px;
}
.theme-toggle input{
  appearance:none;
  width:44px;height:22px;
  background:#ccc;border-radius:20px;position:relative;
}
.theme-toggle input:checked{background:var(--button)}
.theme-toggle input::before{
  content:"";width:18px;height:18px;border-radius:50%;
  background:#fff;position:absolute;top:2px;left:2px;transition:.3s;
}
.theme-toggle input:checked::before{left:24px}

.editor{width:100%;max-width:420px;margin:auto}

.frame{
  background:var(--card);
  border-radius:16px;
  overflow:hidden;
  box-shadow:0 10px 25px rgba(0,0,0,0.06);
}

.frame-header{
  text-align:center;
  padding:20px;
  font-size:24px;
  font-weight:600;
  color:var(--accent);
}

.user-row{
  display:flex;
  align-items:center;
  gap:10px;
  padding:12px 16px;
  font-weight:600;
}
.avatar{
  width:42px;height:42px;border-radius:50%;
  background:linear-gradient(135deg,#e6c9a8,#d4a373);
}

.image-area{
  width:100%;
  aspect-ratio:1/1;
  background:#ececec;
  position:relative;
  overflow:hidden;
  touch-action:none;
}
.image-area img{
  position:absolute;
  top:50%;left:50%;
  transform-origin:center;
}

.caption{
  padding:16px;
  font-size:14px;
}
.hashtags a{
  color:var(--accent);
  text-decoration:none;
  margin-right:6px;
  font-weight:500;
}

.controls input,.controls select,.controls button{
  width:100%;
  margin-top:8px;
  padding:10px;
  border-radius:10px;
  border:1px solid #ddd;
  background:var(--card);
  color:var(--text);
  font-family:inherit;
}
.controls button{
  background:var(--button);
  color:#fff;
  border:none;
  font-weight:600;
}

.notice{
  text-align:center;
  font-size:13px;
  color:var(--accent);
  margin-top:6px;
  height:18px;
}
</style>
</head>

<body>

<div class="theme-toggle">
  Dark Mode
  <input type="checkbox" onchange="toggleMode(this)">
</div>

<h2 style="text-align:center;">HE5 Solutions Professional Frame</h2>

<div class="editor">
  <div class="frame" id="captureArea">
    <div class="frame-header">HE5 Solutions</div>

    <div class="user-row">
      <div class="avatar"></div>
      HE5 Solutions
    </div>

    <div class="image-area" id="imageContainer">
      <img id="photoPreview">
    </div>

    <div class="caption">
      <div id="mainCaption">Professional caption will appear here</div>
      <div id="hashTags" class="hashtags"></div>
    </div>
  </div>

  <div class="controls">
    <input type="file" id="photoInput" accept="image/*">
    <select id="fitMode">
      <option value="cover">Fill Frame</option>
      <option value="contain">Fit Inside</option>
    </select>
    <input type="range" id="zoomSlider" min="1" max="3" step="0.05" value="1">
    <input type="text" id="captionInput" placeholder="Enter technical caption with #hashtags...">
    <button onclick="downloadImage()">Download Image</button>
    <button onclick="shareImage()">Share Image</button>
    <div class="notice" id="copyNotice"></div>
  </div>
</div>

<script>
const DEFAULT_HASHTAGS=["#HE5Solutions","#Innovation","#Engineering"];
const captionNotice=document.getElementById("copyNotice");
const photoPreview=document.getElementById("photoPreview");
const photoInput=document.getElementById("photoInput");
const captionInput=document.getElementById("captionInput");
const mainCaption=document.getElementById("mainCaption");
const hashTags=document.getElementById("hashTags");
const zoomSlider=document.getElementById("zoomSlider");
const fitMode=document.getElementById("fitMode");
const imageContainer=document.getElementById("imageContainer");

let scale=1,baseScale=1,posX=0,posY=0,startX=0,startY=0,isDragging=false,startDist=0,startScale=1;

function renderHashtags(tags){
  hashTags.innerHTML=tags.map(t=>`<a href="https://www.instagram.com/explore/tags/${t.replace('#','')}/" target="_blank">${t}</a>`).join("");
}
renderHashtags(DEFAULT_HASHTAGS);

captionInput.addEventListener("input",()=>{
  const words=captionInput.value.trim().split(" ");
  const userTags=words.filter(w=>w.startsWith("#"));
  const captionWords=words.filter(w=>!w.startsWith("#"));
  mainCaption.textContent="Project update: "+(captionWords.join(" ")||"Engineering excellence in progress.");
  renderHashtags([...userTags,...DEFAULT_HASHTAGS]);
});

photoInput.addEventListener("change",e=>{
  const reader=new FileReader();
  reader.onload=ev=>photoPreview.src=ev.target.result;
  reader.readAsDataURL(e.target.files[0]);
});

photoPreview.onload=()=>applyFit();
fitMode.addEventListener("change",applyFit);

function applyFit(){
  const size=imageContainer.offsetWidth;
  const imgW=photoPreview.naturalWidth;
  const imgH=photoPreview.naturalHeight;
  baseScale=fitMode.value==="cover"?Math.max(size/imgW,size/imgH):Math.min(size/imgW,size/imgH);
  scale=baseScale;zoomSlider.value=1;posX=0;posY=0;updateTransform();
}

zoomSlider.addEventListener("input",()=>{scale=baseScale*zoomSlider.value;updateTransform();});
function updateTransform(){photoPreview.style.transform=`translate(-50%,-50%) translate(${posX}px,${posY}px) scale(${scale})`;}

/* Drag */
imageContainer.addEventListener("pointerdown",e=>{isDragging=true;startX=e.clientX-posX;startY=e.clientY-posY;});
imageContainer.addEventListener("pointermove",e=>{if(!isDragging)return;posX=e.clientX-startX;posY=e.clientY-startY;updateTransform();});
imageContainer.addEventListener("pointerup",()=>isDragging=false);

/* Pinch Zoom */
imageContainer.addEventListener("touchmove",e=>{
 if(e.touches.length===2){
  e.preventDefault();
  const dx=e.touches[0].clientX-e.touches[1].clientX;
  const dy=e.touches[0].clientY-e.touches[1].clientY;
  const dist=Math.sqrt(dx*dx+dy*dy);
  if(!startDist){startDist=dist;startScale=scale;}
  scale=startScale*(dist/startDist);
  zoomSlider.value=scale/baseScale;
  updateTransform();
 }
});
imageContainer.addEventListener("touchend",()=>startDist=0);

function generateCanvas(){return html2canvas(document.getElementById("captureArea"),{backgroundColor:null});}

function downloadImage(){
 generateCanvas().then(c=>{
  const a=document.createElement("a");
  a.download="he5-professional-post.png";
  a.href=c.toDataURL();
  a.click();
 });
}

async function shareImage(){
 const canvas=await generateCanvas();
 const text=`${mainCaption.textContent} ${Array.from(hashTags.querySelectorAll("a")).map(x=>x.textContent).join(" ")}`;
 try{
   await navigator.clipboard.writeText(text);
   captionNotice.textContent="Caption & hashtags copied!";
   setTimeout(()=>captionNotice.textContent="",2000);
 }catch{}
 canvas.toBlob(async blob=>{
   const file=new File([blob],"he5-professional-post.png",{type:"image/png"});
   if(navigator.share && navigator.canShare({files:[file]})){
     await navigator.share({files:[file],text,title:"HE5 Solutions Update"});
   }
 });
}

function toggleMode(el){document.body.classList.toggle("dark",el.checked);}
</script>
</body>
</html>
